local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

local function addESP(player)
	if player == LocalPlayer then return end

	local function setup(character)
		if character:FindFirstChild("ESP_GUI") then
			character.ESP_GUI:Destroy()
		end

		local humanoid = character:WaitForChild("Humanoid")
		local root = character:WaitForChild("HumanoidRootPart")

		humanoid.MaxHealth = 100
		humanoid.Health = math.clamp(humanoid.Health, 0, 100)

		-- üîΩ ALTURA M√ÅS BAJA
		local attach = Instance.new("Attachment")
		attach.Position = Vector3.new(0, 20, 0) -- antes 25
		attach.Parent = root

		local gui = Instance.new("BillboardGui")
		gui.Name = "ESP_GUI"
		gui.Adornee = attach
		gui.Size = UDim2.new(18, 0, 2.5, 0)
		gui.AlwaysOnTop = true
		gui.MaxDistance = math.huge
		gui.LightInfluence = 0
		gui.Parent = character

		-- TEXTO √öNICO
		local label = Instance.new("TextLabel")
		label.Size = UDim2.new(1,0,1,0)
		label.BackgroundTransparency = 1
		label.TextScaled = false
		label.TextSize = 20 -- üëà TAMA√ëO PEDIDO
		label.Font = Enum.Font.GothamBold
		label.TextColor3 = Color3.new(1,1,1)
		label.TextStrokeColor3 = Color3.new(0,0,0)
		label.TextStrokeTransparency = 0
		label.TextXAlignment = Enum.TextXAlignment.Center
		label.TextYAlignment = Enum.TextYAlignment.Center
		label.Parent = gui

		RunService.RenderStepped:Connect(function()
			if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
				local dist = (LocalPlayer.Character.HumanoidRootPart.Position - root.Position).Magnitude
				label.Text =
					"Name: "..player.Name..
					" | Health: "..math.floor(humanoid.Health)..
					" | Studs: "..math.floor(dist)
			end
		end)
	end

	player.CharacterAdded:Connect(setup)
	if player.Character then
		setup(player.Character)
	end
end

for _, p in ipairs(Players:GetPlayers()) do
	addESP(p)
end

Players.PlayerAdded:Connect(addESP)
